[Мой телеграм](https://t.me/misty_light)

# Установка и первоначальная настройка

1. Установить Python 3.11
2. Добавить Python в переменные окружения ОС
3. Установить PostgreSQL (можно сразу вместе с pgAdmin)
4. Создать сервер и базу данных PostgreSQL
5. Создать директорию для проекта, перейти в неё
6. В директории:
   1. ввести команду `git init`
   2. ввести команду `git clone https://github.com/PavelUmanskiy/django_test/ main`
7. Создать и активировать виртуальное окружение:
   1. Ввести команду для создания `python -m venv <имя окружения>`, где `<имя окружения>` - имя вашего будущего окружения
   2. Ввести команду для активации `.\<имя_окружения>\Scripts\activate`
   3. Дополнительно: если в конце понадобится выйти из виртуального окружения, можно ввести команду `deactivate`
8. Установить зависимости в окружение командой `pip install -r requirements.txt`
9. В файле `.gitignore` добавить строчку `<имя окружения>/`
9. Перейти в директорию `survey_project\survey_project\` (в ней должен лежать файл `settings.py`)
10. Создать файл с именем `.env` - в нём будет хранится приватная информация
11. Заполнить этот файл по следующему образцу:
```
SETTINGS_SECRET_KEY=x1
DB_NAME=x2
DB_USERNAME=x3
DB_USER_PASSWORD=x4
```
Где:
* x1 это случайная строка (например, `'abcdefgh'`)
* x2 это имя вашей базы данных, которое вы задали при её создании (например, `'test_db'`)
* x3 это ваше имя пользователя PostgreSQL (по умолчанию, `'postgres'`)
* x4 это ваш пароль в базе данных (например, `'qwerty1234'`)
12. Вернуться в директорию `survey_project` (где лежит файл `manage.py`)
13. Провести миграции командами `python manage.py makemigrations` и `python manage.py migrate`
13. Создать суперпользователя Django командой `python manage.py createsuperuser` и следовать распоряжениям в терминале (пароль вводится, этого просто не видно)

# Запуск 

1. Убедится, что вы находитесь в директории `survey_project` (где лежит файл `manage.py`)
2. Ввести команду `python manage.py runserver`
3. В терминале появиться ссылка на `http://127.0.0.1:8000/`, кликнуть по ней, удерживая клавишу Ctrl
    
# Работа с созданием опросов и вопросов в админке

Модель Question является сложным, но гибким элементом системы опросов.
У неё есть следующие поля:
1. survey - ссылка на модель опросов
2. next_question - ссылка на следующий вопрос
3. is_choices - является ли вопрос с вариантами ответов
4. choices - варианты ответов
5. question_text - текст вопроса, единственное обязательное поле
6. is_branching - флаг, является ли вопрос ветвящимся (т.е. зависит ли следующий вопрос от ответа на этот)
7. depends_on - ссылка на родительский вопрос с ветвлением
8. right_answer - правильный ответ на вопрос
9. default_branch - ссылка на вопрос, который будет следующим, если на этот вопрос ответили не правильно

## Как это работает и как этим пользоваться?

Моя модель позволяет создавать как одиночные вопросы, так и вопросы, которые являются частью опроса.
Вопросы могут быть как ветвящимися, так и цепочкой вопросов; как вопросы с вариантами выбора (количество вариантов задаётся администратором и его можно увеличить), так и ожидающие развёрнутого ответа.

В админке можно в любой момент отредактировать опросы и вопросы, нажав на ID элемента

### Как создать опрос?

1. В админке перейти в пункт меню Surveys
2. Справа нажать кнопку "Add Survey" ("Добавить Опрос")
3. Поля:
    1. Author - выбрать, от чьего лица создаётся опрос
    2. Description - Описание (опционально)
    3. First question - ссылка на первый вопрос из опроса. Пока не будет создан хотя бы один вопрос, заполнить это поле нечем, но к нему потом можно вернуться

### Общие правила и порядок создания вопроса
1. В админке перейти в пункт меню Questions
2. Справа нажать кнопку "Add Question" ("Добавить Вопрос")
3. Поля:
    1. Survey - ссылка на опрос. Если ещё ни одного опроса не создано, можно оставить пустым
    2. Next question - ссылка на следующий вопрос. Если он ещё не создан, можно оставить пустым
    3. Is choices - если поставить галочку, приложение будет воспринимать этот вопрос как вопрос с вариантами выбора, и пользователь, при ответе на него, выберет один из предоставленных вариантов. Если не ставить, приложение будет воспринимать этот вопрос как вопрос с развёрнутым ответом. Пользователю будет предоставлено поле для ввода текста
    4. Choices - варианты ответов, которые будут предоставлены пользователю, если проставлена галочка в "Is choices". Как следует вводить варианты ответа: `choice_1,choice_2,choice_3`. То есть через запятую, *без пробелов*. Я поставил защиту от пробелов, но всё равно не стоит ставить пробелы - для правильного соотнешиния данных в бд и на экране пользователя.
    5. Question text - текст вопроса, который увидит пользователь
    6. Is branching - если поставить галочку, с этого вопроса начнётся ветвление, и следующий вопрос, который увидет пользователь, будет зависеть от ответа на этот
    7. Depends on - ссылка на вопрос с ветвлением, ветвью которого является этот вопрос
    8. Right answer - правильный ответ на вопрос. В случае, если этот вопрос является разветвлённым, ответ пользователя будтет сравнён с этим полем. Если он равны, следующим вопросом станет вопрос, указанный в "Next question". Если в "Is choices" поставлена галочка, нужно убедится, что правильный ответ есть в списке (например `choice_1` - внимание: *без запятых*)
    9. Default branch - ссылка на вопрос, который будет следующим, если пользователь ответил на этот вопрос неправильно (при условии что этот вопрос ветвящийся)
4. Нажать кнопку "Save"

### Как создать одиночный, независимый вопрос?

Чтобы создать одиночный вопрос достаточно только заполнить поля "Question text" и выбрать тип ответа в поле "Is choices". Если галочка поставлена, необходимо прописать варианты ответа в "Choices"

### Как создать линейный опрос без ветвления?

1. Создать опрос (см. "Как создать опрос?"). Поле "First question" пока оставлям пустым
2. Создать первый вопрос (пункт меню "Questions"):
    1. В "Survey" указать новый опрос из прошлого пункта
    2. "Next question" пока оставляем пустым
    3. Если вопрос должен быть с вариантами ответа, поставить галочку в "Is choices" и заполняем "Choices". Если вопрос должен быть с развёрнутым ответом, галочка не ставится и "Choices" не заполняются
    4. В "Question text" вводится текст вопроса
    5. Поля "Is branching", "Depends on", "Right answer" и "Default branch" пропустить
    6. Нажать кнопку "Save"
3. Вернуться в "Surveys"
    1. Кликнуть по ID опроса, чтоьбы перейти в режим детального редактирования
    2. Указать созданный вопрос в поле "First question"
    3. Нажать кнопку "Save"
4. Вернуться в "Questions"
5. Добавить второй вопрос (см. пункт 2)
6. В первом созданном вопросе, в поле "Next question" указать второй созданный вопрос, сохранить
7. Повторить с пункта 2 столько раз, сколько нужно вопросов
8. Чтобы закончить опрос, нужно просто оставить поле "Next question" пустым

### Как создать опрос с ветвлением?

1. Создать опрос (см. "Как создать опрос?"). Поле "First question" пока оставлям пустым
2. Создать первый вопрос (пункт меню "Questions"):
    1. В "Survey" указать новый опрос из прошлого пункта
    2. "Next question" пока оставляем пустым
    3. Если вопрос должен быть с вариантами ответа, поставить галочку в "Is choices" и заполняем "Choices". Если вопрос должен быть с развёрнутым ответом, галочка не ставится и "Choices" не заполняются
    4. В "Question text" вводится текст вопроса
    5. Если вопрос должен быть с ветвлением: 
        * Поставить в поле "Is branching" галочку
        * Указать правильный ответ в "Right answer"
    6. Нажать кнопку "Save"
3. Вернуться в "Surveys"
    1. Кликнуть по ID опроса, чтоьбы перейти в режим детального редактирования
    2. Указать созданный вопрос в поле "First question"
    3. Нажать кнопку "Save"
4. Вернуться в "Questions"
5. Если предыдущий вопрос был с ветвлением:
    1. Создать два новых вопроса вопрос:
        * Следовать обычному порядку создания вопроса
        * В поле "Depends on" указать вопрос с ветвлением
        * Сохранить
    2. В вопросе с ветвлением:
        * В поле "Next question" указать тот вопрос, который покажется, если ответ пользователя сойдётся с "Right answer"
        * В поле "Default branch" указать тот вопрос, который покажется, если ответ пользователя *не* сойдётся с "Right answer"
        * Сохранить
Если предыдущий вопрос без ветвления:
* Создать новый вопрос как в пункте 2
6. Повторить с пункта 2 столько раз, сколько нужно вопросов
7. Чтобы закончить опрос, нужно просто оставить поле "Next question" пустым
    
### Общие советы

* Не стоит создавать ветвящийся вопрос, если он не является вопросом с вариантами ответа. Это может привести к такой ситуации, когда пользователь введёт правильный ответ, а ему он не засчитается. Например, вы указали в "Right answer" что правильный ответ должен быть "Python", а пользователь ввёл "python" или просто опечатался - такой ответ на засчитается, и пользователь увидит вопрос из "Default branch". Совет: если вопрос ветвится, пусть он будет с вариантами ответа.
* Количество вариантов ответа задаётся администратором. Может быть как один вариант ответа, так и 100. Единственное ограничение - та строка в "Choices" имеет ограничение по длине в 128 символов. Если нужно много вариантов ответа с длинными описаниями, лучше указать их в самом вопросе и пронумеровать, а в качестве вариантов ответа указать номера вариантов ответа. В "Right answer" в таком случае нужно указать номер правильного ответа, а не его развёрнутое описание из текста вопроса.
* Не обязательно рассматривать "Right answer" именно как "правильный" ответ. Это может быть просто условием развилки.
* Если будут какие-то вопросы по использованию приложения, вот [мой телеграм](https://t.me/misty_light)

### Технические заметки

* Если нужно увеличить длину строки для "Choices", нужно в модели `Question`, в атрибуте `choices` задать большее значение в параметре `max_length`.
* Приложение на данный момент не поддерживает вопросы с несколькими вариантами ответа - пришлось бы подключать ManyToMany, а логика выбора следующего вопроса, и без того разветвлённая, стала бы ещё сложнее. По той же причине у вопроса может быть только две ветви.
* Я бы оформил вывод статистики по-другому, но я придерживаюсь условий задания.
* Я не настолько хорошо владею Pandas, как хотелось бы, так что возможно алгоритм в `data_processing.py` можно было бы улучшить.
* Я не стал включать проверки на стороне бд или Django по типу: "Если у вопроса указано `is_choices = True`, то у него строка `choices` обязана быть заполнена". Связано это с временными затратами на это, но я могу это сделать.
* Фронтенд здесь функциональный, написан с использованием HTMX
